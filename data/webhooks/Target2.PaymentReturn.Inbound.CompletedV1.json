{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "title": "Target2PaymentReturnInboundCompletedWebHook",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "PaymentReturnId",
	"OriginalEndToEndId",
	"OriginalUetr",
    "ReturnedSettlementAmount",
	"TransactionId",
    "ReturnReason"
  ],
  "properties": {
	"PaymentReturnId": {
	  "title": "Payment ID",
      "type": "string",
      "pattern": "[a-zA-Z0-9_-]{0,50}",
      "description": "ClearBank internal identifier for this payment."
    },
	"OriginalInstructionId": {
      "title": "Customer internal identifier",
      "type": ["string","null"],
      "Pattern": "[0-9a-zA-Z\/\\-\\?:\\(\\)\\.,'\\+](|[0-9a-zA-Z\/\\-\\?:\\(\\)\\.,'\\+]|[0-9a-zA-Z\/\\-\\?:\\(\\)\\.,'\\+ ]{1,33}[0-9a-zA-Z\/\\-\\?:\\(\\)\\.,'\\+])",
      "description": "Unique identification, as assigned by an instructing party for an instructed party, to unambiguously identify the instruction."
    },
	"OriginalEndToEndId": {
      "title": "End to end ID",
      "type": "string",
      "pattern": "[0-9a-zA-Z\/\\-\\?:\\(\\)\\.,'\\+](|[0-9a-zA-Z\/\\-\\?:\\(\\)\\.,'\\+]|[0-9a-zA-Z\/\\-\\?:\\(\\)\\.,'\\+ ]{1,33}[0-9a-zA-Z\/\\-\\?:\\(\\)\\.,'\\+])",
      "description": "Unique identifier provided to ClearBank for each payment."
    },
    "OriginalUetr": {
      "title": "Unique end-to-end reference",
      "type": "string",
      "format": "guid",
      "pattern": "[a-f0-9]{8}-[a-f0-9]{4}-4[a-f0-9]{3}-[89ab][a-f0-9]{3}-[a-f0-9]{12}",
      "description": "Universally unique UUID v4 identifier randomly generated to provide an end-to-end reference of a payment transaction."
    },
    "TransactionId": {
      "title": "Transaction ID",
      "type": "string",
      "format": "guid",
      "pattern": "[a-f0-9]{8}-[a-f0-9]{4}-4[a-f0-9]{3}-[89ab][a-f0-9]{3}-[a-f0-9]{12}",
      "description": "ID of the transaction used to move funds for this payment."
    },
    "ReturnReason": { 
      "title": "Return reasons",
      "type": "object",
      "description": "Provides detailed information on the return reason.",
      "required": ["Code"],
      "properties": {
        "Code": {
          "title": "Return reason Code",
          "type": "string",
          "description": "Return reason code (as defined in ISO 20022).",
          "maxLength": 4,
          "minLength": 1
        },
        "ReturnReasonAdditionalInformation": {
          "title": "Return reason additional information",
          "description": "Description associated with the return reason code.",
          "type": ["array","null"],
          "maxItems": 2,
          "items": {
            "type": "string"
          }  
        }
      } 
    },
    "OriginalSettlementAmount": {
      "oneOf": [
          {"type": "null"},
          {"$ref": "#/definitions/SettlementAmount"}
      ]            
    },
    "ReturnedSettlementAmount": {
      "oneOf": [
        {
          "$ref": "#/definitions/SettlementAmount"
        }
      ]            
    },
    "UltimateDebtor": {
      "oneOf": [
          {"type": "null"},
          {"$ref": "#/definitions/PartyId"}
      ]
    },
    "UltimateCreditor": {
      "oneOf": [
          {"type": "null"},
          {"$ref": "#/definitions/PartyId"}
      ]
    },
    "Creditor": {
      "oneOf": [
        {"type": "null"},
        {"$ref": "#/definitions/ReturnParty"}
      ]    
    },
    "CreditorAgent": {
      "oneOf": [
        {"type": "null"},
        { "$ref": "#/definitions/FinancialInstitutionId" }
      ]
    },
    "Debtor": {
      "oneOf": [
        {"type": "null"},
        {"$ref": "#/definitions/ReturnParty"}
      ]    
    },
    "InitiatingParty": {
      "oneOf": [
        {"type": "null"},
        {"$ref": "#/definitions/ReturnParty"}
      ]    
    },
    "DebtorAgent": {
      "oneOf": [
        {"type": "null"},
        { "$ref": "#/definitions/FinancialInstitutionId" }
      ]
    },
    "PreviousInstructingAgents": {
      "title": "Previous instructing agents",
      "type": ["array","null"],
      "maxItems": 3,
      "items": [
        {
          "$ref": "#/definitions/FinancialInstitutionId"
        }
      ]    
    },
    "ReturnOriginator": {
      "oneOf": [
        {"type": "null"},
        {"$ref": "#/definitions/PartyId"}
      ]    
    }
  },
  "definitions": {
    "ReturnParty": {
      "type": "object",
      "anyOf": [
        {"Agent": {"$ref": "#/definitions/FinancialInstitutionId"}},
        {"Party": {"$ref": "#/definitions/PartyId"}}
      ]
    },
    "PreviousInstructingAgent": {
      "type": "object",
      "properties": {
        "type": {"$ref": "#/definitions/FinancialInstitutionId"},
        "type": {"$ref": "#/definitions/Account"} 
      }
    },
    "SettlementAmount": {
      "type": "object",
      "additionalProperties": true,
      "required": ["Amount", "Currency"],
      "properties": {
        "Amount": {
          "title": "Amount",
          "type": "number",
          "description": "Settlement payment amount.",
          "format": "decimal"
        },
        "Currency": {
          "title": "Currency",
          "type": "string",
          "description": "Currency of the settlement amount.",
          "pattern": "[A-Z]{3,3}"
        }
      }    
    },
    "PartyId": {
      "type": ["object", "null"],
      "additionalProperties": true,
      "properties": {
        "Name": {
          "title": "name",
          "type": ["string", "null"],
          "description": "Name by which a party is known and which is usually used to identify that party.",
          "maxLength": 140,
          "minLength": 1
        },
        "Bic": {
          "title": "BIC",
          "type": ["string", "null"],
          "pattern": "[A-Z0-9]{4,4}[A-Z]{2,2}[A-Z0-9]{2,2}[A-Z0-9]{3,3}",
          "description": "Business identifier code of the organisation."
        },
        "Address":{
          "oneOf": [
            {
              "$ref": "#/definitions/Address"
            }
          ]      
        }
      }    
    },    
    "FinancialInstitutionId": {
      "type": ["object","null"],
      "additionalProperties": true,
      "properties": {
        "Name": {
          "title": "name",
          "type": ["string", "null"],
          "description": "Name by which the financial institution is known and which is usually used to identify that party.",
          "maxLength": 140,
          "minLength": 1
        },
        "BicFI": {
          "title": "BIC",
          "type": ["string", "null"],
          "pattern": "[A-Z0-9]{4,4}[A-Z]{2,2}[A-Z0-9]{2,2}[A-Z0-9]{3,3}",
          "description": "Business identifier code of the organisation."
        },
        "Address":{
          "oneOf": [
            {
              "$ref": "#/definitions/Address"
            }
          ]      
        }
      }    
    },
    "Address": {
      "type": ["object","null"],
      "additionalProperties": true,
      "TownName": {
        "title": "Town name",
        "type": ["string", "null"],
        "description": "Name of a built-up area, with defined boundaries, and a local government.",
        "pattern": "[0-9a-zA-Z\/\\-\\?:\\(\\)\\.,'\\+!#$%&\\*=^_`\\{\\|\\}~\";<>@\\[\\\\\\]](|[0-9a-zA-Z\/\\-\\?:\\(\\)\\.,'\\+!#$%&\\*=^_`\\{\\|\\}~\";<>@\\[\\\\\\]]|[0-9a-zA-Z\/\\-\\?:\\(\\)\\.,'\\+ !#$%&\\*=^_`\\{\\|\\}~\";<>@\\[\\\\\\]]{1,33}[0-9a-zA-Z\/\\-\\?:\\(\\)\\.,'\\+!#$%&\\*=^_`\\{\\|\\}~\";<>@\\[\\\\\\]])",
        "maxLength": 35,
        "minLength": 1
      },
      "Country": {
        "title": "Country",
        "type": ["string", "null"],
        "pattern": "[A-Z]{2,2}",
        "description": "Nation with its own government."
      },
      "AddressLines": {
        "title": "Address lines",
        "type": ["array","null"],
        "maxItems": 3,
        "items": {
          "$ref": "#/definitions/AddressLine"  
        }
      }
    },
    "AddressLine": {
      "type": ["string", "null"],
      "maxLength": 35,
      "minLength": 1       
    },
    "Account": {
      "type": ["object", "null"],
      "additionalProperties": true,
      "properties": {
        "Iban": {
          "title" : "IBAN",
          "type": ["string", "null"],
          "description": "International Bank Account Number associated with the party",
          "pattern": "[A-Z]{2,2}[0-9]{2,2}[a-zA-Z0-9]{1,30}"
        }  
      }
    }
  }
}