{
  "openapi": "3.0.1",
  "info": {
    "title": "ClearBank.InterestAccrual.Api",
    "version": "1.0.Savings.Config"
  },
  "paths": {
    "/interest/v1/accounts/{accountId}/configurations": {
      "get": {
        "tags": [
          "Accounts"
        ],
        "summary": "This endpoint is used to retrieve past, current, and future interest configurations for a savings account.",
        "parameters": [
          {
            "name": "AccountId",
            "in": "path",
            "description": "The unique identifier for the account. This can be retrieved from GET /v3/Accounts.",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          },
          {
            "name": "Authorization",
            "in": "header",
            "description": "Your API Token, obtained from the ClearBank Portal.",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/GetAccountInterestConfigurationsResponse"
                }
              },
              "application/problem+json": {
                "schema": {
                  "$ref": "#/components/schemas/GetAccountInterestConfigurationsResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProblemDetails"
                }
              },
              "application/problem+json": {
                "schema": {
                  "$ref": "#/components/schemas/ProblemDetails"
                }
              }
            }
          },
          "404": {
            "description": "Not Found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProblemDetails"
                }
              },
              "application/problem+json": {
                "schema": {
                  "$ref": "#/components/schemas/ProblemDetails"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Accounts"
        ],
        "summary": "This endpoint is used to update an interest configuration for a savings account.",
        "parameters": [
          {
            "name": "accountId",
            "in": "path",
            "description": "The unique identifier for the account. This can be retrieved from GET /v3/Accounts.",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          },
          {
            "name": "Authorization",
            "in": "header",
            "description": "Your API Token, obtained from the ClearBank Portal.",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "DigitalSignature",
            "in": "header",
            "description": "Signed hash of the body of the request. The hash is signed by your private key.",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "X-Request-Id",
            "in": "header",
            "description": "A unique identifier for the request; valid for 24 hours, max length 83.",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "description": "",
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateAccountInterestConfigurationRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AccountInterestConfiguration"
                }
              },
              "application/problem+json": {
                "schema": {
                  "$ref": "#/components/schemas/AccountInterestConfiguration"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProblemDetails"
                }
              },
              "application/problem+json": {
                "schema": {
                  "$ref": "#/components/schemas/ProblemDetails"
                }
              }
            }
          },
          "404": {
            "description": "Not Found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProblemDetails"
                }
              },
              "application/problem+json": {
                "schema": {
                  "$ref": "#/components/schemas/ProblemDetails"
                }
              }
            }
          },
          "409": {
            "description": "Conflict",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProblemDetails"
                }
              },
              "application/problem+json": {
                "schema": {
                  "$ref": "#/components/schemas/ProblemDetails"
                }
              }
            }
          }
        }
      }
    },
    "/interest/v1/accounts/{accountId}/future-configurations": {
      "put": {
        "tags": [
          "FutureDatedAccountInterestConfigurations"
        ],
        "parameters": [
          {
            "name": "AccountId",
            "in": "path",
            "description": "The unique identifier for the account. This can be retrieved from GET /v3/Accounts.",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          },
          {
            "name": "Authorization",
            "in": "header",
            "description": "Your API Token, obtained from the ClearBank Portal.",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "DigitalSignature",
            "in": "header",
            "description": "Signed hash of the body of the request. The hash is signed by your private key.",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "X-Request-Id",
            "in": "header",
            "description": "A unique identifier for the request; valid for 24 hours, max length 83.",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateFutureDatedAccountInterestConfigurationRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OK"
          },
          "400": {
            "description": "Bad Request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProblemDetails"
                }
              },
              "application/problem+json": {
                "schema": {
                  "$ref": "#/components/schemas/ProblemDetails"
                }
              }
            }
          },
          "404": {
            "description": "Not Found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProblemDetails"
                }
              },
              "application/problem+json": {
                "schema": {
                  "$ref": "#/components/schemas/ProblemDetails"
                }
              }
            }
          },
          "409": {
            "description": "Conflict",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProblemDetails"
                }
              },
              "application/problem+json": {
                "schema": {
                  "$ref": "#/components/schemas/ProblemDetails"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "FutureDatedAccountInterestConfigurations"
        ],
        "parameters": [
          {
            "name": "AccountId",
            "in": "path",
            "description": "The unique identifier for the account. This can be retrieved from GET /v3/Accounts.",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          },
          {
            "name": "Authorization",
            "in": "header",
            "description": "Your API Token, obtained from the ClearBank Portal",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "X-Request-Id",
            "in": "header",
            "description": "A unique identifier for the request; valid for 24 hours, max length 83.",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "No Content"
          },
          "404": {
            "description": "Not Found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProblemDetails"
                }
              },
              "application/problem+json": {
                "schema": {
                  "$ref": "#/components/schemas/ProblemDetails"
                }
              }
            }
          }
        }
      }
    },
    "/interest/v1/configurations/{interestConfigurationId}": {
      "get": {
        "tags": [
          "InterestConfigurations"
        ],
        "summary": "Fetch interest configurations for a specific institution.",
        "description": "Returns the most recent active interest configuration for a specified institution based on a given date. If no date is specified, it retrieves the configuration currently in effect. For a past date, it provides the configuration that was active on that date. Configurations with future start dates are excluded, so providing a future date will yield the same result as using the current date.",
        "parameters": [
          {
            "name": "interestConfigurationId",
            "in": "path",
            "description": "The unique identifier for the interest configuration.",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          },
          {
            "name": "effectiveAt",
            "in": "query",
            "description": "The effective date for filtering interest configurations. Defaults to the current UTC date-time if not provided.",
            "schema": {
              "type": "string",
              "format": "date-time"
            }
          },
          {
            "name": "Authorization",
            "in": "header",
            "description": "Your API Token, obtained from the ClearBank Portal.",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/GetInterestConfigurationResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not Found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProblemDetails"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "AccountInterestConfiguration": {
        "type": "object",
        "properties": {
          "accountId": {
            "type": "string",
            "format": "uuid",
            "description": "The unique identifier for the account. This can be retrieved from GET /v3/Accounts."
          },
          "interestConfigurationId": {
            "type": "string",
            "format": "uuid",
            "description": "The UUID indicating the interest configuration for the account. If you don't have this, speak to your Client Director."
          },
          "effectiveFrom": {
            "type": "string",
            "format": "date",
            "description": "Date that the interestConfigurationID becomes effective. Format: Date",
            "example": "2025-08-24"
          }
        },
        "additionalProperties": false
      },
      "CreateAccountInterestConfigurationRequest": {
        "type": "object",
        "required": [
          "interestConfigurationId"
        ],
        "properties": {
          "interestConfigurationId": {
            "type": "string",
            "description": "The UUID indicating the interest configuration for the account. If you don't have this, speak to your Client Director.",
            "format": "uuid",
            "example": "5C35D48D-0R3D-47BE-9F54-I9F3328L7V2A"
          }
        },
        "additionalProperties": false
      },
      "GetAccountInterestConfigurationsResponse": {
        "type": "object",
        "properties": {
          "future": {
          "description": "List of interest configurations that are scheduled to come into effect after today.",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/AccountInterestConfigurationItem"
            },
            "nullable": true
          },
          "current": {
            "description": "Interest configuration that is currently applicable. If you have changed the interest configuration multiple times today, the most recent change will be used and is returned here.",
            "$ref": "#/components/schemas/AccountInterestConfigurationItem"
          },
          "past": {
            "description": "List of all previous interest configurations that have been active on this account.",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/AccountInterestConfigurationItem"
            },
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "AccountInterestConfigurationItem": {
        "type": "object",
        "properties": {
          "effectiveFrom": {
            "type": "string",
            "format": "date",
            "description": "Date the interestConfigurationID becomes effective. Format: Date",
            "example": "2025-08-24"
          },
          "interestConfigurationId": {
            "type": "string",
            "format": "uuid",
            "description": "The UUID indicating the interest configuration for the account. If you don't have this, speak to your Client Director."
          },
          "name": {
            "type": "string",
            "nullable": true,
            "description": "Name of the interest configuration."
          }
        },
        "additionalProperties": false
      },
      "CreateFutureDatedAccountInterestConfigurationRequest": {
        "type": "object",
        "required": [
          "interestConfigurations"
        ],
        "properties": {
          "interestConfigurations": {
            "type": "array",
            "description": "A list of future-dated interest configurations for the account.",
            "items": {
              "$ref": "#/components/schemas/FutureDatedAccountInterestConfiguration"
            },
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "FutureDatedAccountInterestConfiguration": {
        "required": [
          "interestConfigurationId",
          "effectiveFrom"
        ],
        "type": "object",
        "properties": {
          "interestConfigurationId": {
            "type": "string",
            "format": "uuid",
            "description": "The UUID indicating the interest configuration for the account. If you don't have this, speak to your Client Director."
          },
          "effectiveFrom": {
            "type": "string",
            "format": "date",
            "description": "Date that the interestConfigurationID becomes effective. Format: Date.",
            "example": "2027-10-01"
          }
        },
        "additionalProperties": false
      },
      "GetInterestConfigurationResponse": {
        "type": "object",
        "properties": {
          "interestConfigurations": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/InterestConfiguration"
            }
          }
        }
      },
      "InterestConfiguration": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid",
            "description": "The unique identifier for the interest configuration.",
            "example": "a7a907c5-7062-4d76-8e6c-3b203a758839"
          },
          "institutionId": {
            "type": "string",
            "format": "uuid",
            "description": "The unique identifier for the institution.",
            "example": "1f7304b5-5029-432e-8009-bf2ea2ab47fd"
          },
          "payablePeriod": {
            "type": "string",
            "description": "The frequency of interest payments. Possible values: Daily, Weekly, Monthly, Quarterly, Biannual, Annual.",
            "example": "Daily"
          },
          "payableAccountId": {
            "type": "string",
            "format": "uuid",
            "description": "The unique identifier for the payable account.",
            "example": "7e5e3b83-d76e-4821-9566-a83b322ce2dd"
          },
          "effectiveFrom": {
            "type": "string",
            "format": "date",
            "description": "The start date for the interest configuration.",
            "example": "2025-08-15"
          },
          "effectiveTo": {
            "type": "string",
            "format": "date",
            "nullable": true,
            "description": "The end date for the interest configuration. Can be null for a currently active configuration. It can have a future date if the configuration has a scheduled end.",
            "example": "2025-09-15"
          },
          "timeStampCreated": {
            "type": "string",
            "format": "date-time",
            "description": "The timestamp when the interest configuration was created.",
            "example": "2025-08-18T11:11:45.5666667"
          },
          "timeStampModified": {
            "type": "string",
            "format": "date-time",
            "nullable": true,
            "description": "The timestamp when the interest configuration was last modified. Null on creation, populated after the first update."
          },
          "payablePeriodOffset": {
            "type": "integer",
            "minimum": 0,
            "description": "Offset in days for when interest is paid relative to the start of each payable period. Can only be set when the payment frequency is set to weekly with a value within 0-27. For other payment frequencies it will be 0.",
            "example": 0
          },
          "interestPaymentRoundingAlgorithm": {
            "type": "string",
            "description": "Defines the algorithm used for rounding interest payments when dealing with amounts less than a penny. Possible values: 'ToEven' (round to nearest even number) and 'Truncate' (drop extra decimal places without rounding up).",
            "example": "Truncate"
          },
          "doUnpaidAccrualFractionsRollover": {
            "type": "boolean",
            "description": "Whether unpaid accrual fractions (e.g., less than 1 penny) roll over to the next day. Available when the rounding algorithm is set to 'Truncate'.",
            "example": "false"
          },
          "tierBalanceAllocation": {
            "type": "string",
            "description": "Determines how interest is applied across tiers in the interest configuration. Possible values: 'Segregated' (apply each tier’s rate only to the portion of the balance within that tier) and 'Whole' (apply the rate of the highest qualifying tier to the entire balance).",
            "example": "Whole"
          },
          "interestRate": {
            "type": "number",
            "format": "double",
            "description": "The base interest rate used in the configuration, expressed as a percentage. This rate may reflect a central bank reference rate (e.g. the Bank of England base rate). Represented as percentage, e.g. a value of 7 represents 7%.",
            "example": 7.00
          },
          "tiers": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/InterestConfigurationTier"
            }
          }
        }
      },
      "InterestConfigurationTier": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid",
            "description": "The unique identifier for the tier.",
            "example": "99b386f8-c2f7-4fda-b946-c1384b44bb84"
          },
          "fromAmount": {
            "type": "number",
            "format": "double",
            "description": "This is the initial amount for this tier. For instance, if the tier begins at 0, it will apply starting from 0 and above.",
            "example": 0.00
          },
          "toAmount": {
            "type": "number",
            "format": "double",
            "nullable": true,
            "description": "This is the maximum amount covered by this tier. For instance, if the tier ends at 100, it includes all amounts up to and including 10000. If the value is null, there is no upper limit for this tier.",
            "example": 10000.00
          },
          "percentPayable": {
            "type": "number",
            "format": "double",
            "description": "The percentage of the base rate payable to the customer (EBP) for this tier. Represented as a percentage value, e.g. 0.5 means 0.5%.",
            "example": 0.50
          },
          "clearbankMargin": {
            "type": "number",
            "format": "double",
            "description": "The ClearBank margin applied to the tier. Represented as a percentage value, e.g. 0.2 means 0.2%.",
            "example": 0.20
          },
          "grossRate": {
            "type": "number",
            "format": "double",
            "description": "The gross annual rate for the tier, shown as a percentage. It is calculated by subtracting both the clearbank margin and the percentage paid to the customer from the interest rate. For instance, a value of 6.3 indicates a 6.3% rate.",
            "example": 6.30
          },
          "aer": {
            "type": "number",
            "format": "double",
            "description": "The Annual Equivalent Rate (AER) for the tier, represented as a percentage value. It is calculated using the formula AER = (1 + r/n)^n − 1, where r is the gross annual rate (expressed as a decimal) and n represents the number of payment periods per year (Daily=365, Weekly=52, Monthly=12, Quarterly=4, Biannual=2, Annual=1). Leap years (366 days) and years with 53 Sundays are not considered, as this only affects values after the fifth decimal place. The API returns the raw AER value with up to 8 decimal places. When presenting to customers, it should be rounded to 2 decimal places in line with agreed standards and approach.",
            "example": 6.50210494
          }
        }
      },
      "ProblemDetails": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "nullable": true,
            "description": "A URI reference [RFC3986] that identifies a problem type. When dereferenced,  it provides a human-readable documentation for the problem type. When not present, default value is assumed to be \"about:blank\"."
          },
          "title": {
            "type": "string",
            "nullable": true,
            "description": "A short, human-readable summary of the problem type. "
          },
          "status": {
            "type": "integer",
            "format": "int32",
            "nullable": true,
            "description": "The HTTP status code ([RFC7231], Section 6) generated by the origin server for this occurrence of the problem."
          },
          "detail": {
            "type": "string",
            "nullable": true,
            "description": "A human-readable explanation of what went wrong. It can include specifics about the issue, missing parameters, or invalid data."
          },
          "instance": {
            "type": "string",
            "nullable": true,
            "description": "A URL reference to a retrieve more information about the error, if available."
          }
        },
        "additionalProperties": { }
      }
    }
  }
}