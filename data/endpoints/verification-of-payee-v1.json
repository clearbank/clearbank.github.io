{
  "openapi": "3.0.2",
  "info": {
    "title": "Verification of Payee",
    "version": "1.0VOP"
  },
  "paths": {
    "/open-banking/vop/v1/payees/single": {
      "post": {
        "tags": [
          "PayeeVerificationEndpoint"
        ],
        "summary": "This endpoint is used to conduct a Verification of Payee check using the details of the intended payee against the account holder name at the receiving payment service provider (PSP).",
        "parameters": [
          {
            "name": "Authorization",
            "in": "header",
            "description": "Your API Token, obtained from the ClearBank Portal.",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "DigitalSignature",
            "in": "header",
            "description": "Signed hash of the body of the request. The hash is signed by your private key.",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "X-Request-Id",
            "in": "header",
            "description": "A unique identifier for the request; valid for 24 hours, max length 83.",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PayeeVerificationRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PayeeVerificationResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HttpValidationProblemDetails"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "FinancialInstitutionId": {
        "required": [
          "bicfi"
        ],
        "type": "object",
        "properties": {
          "bicfi": {
            "minLength": 1,
            "pattern": "[A-Z0-9]{4,4}[A-Z]{2,2}[A-Z0-9]{2,2}([A-Z0-9]{3,3}){0,1}",
            "type": "string",
            "description": "Business identifier code (BIC) - Code allocated to a financial institution by the ISO 9362 Registration Authority",
            "example": "CLRBNL2AXXX"
          }
        },
        "additionalProperties": false
      },
      "HttpValidationProblemDetails": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "description": "A URI reference [RFC3986] that identifies a problem type. When dereferenced,  it provides a human-readable documentation for the problem type.\nWhen not present, default value is assumed to be \"about:blank\".",
            "nullable": true
          },
          "title": {
            "type": "string",
            "description": "A short, human-readable summary of the problem type.",
            "nullable": true
          },
          "status": {
            "type": "integer",
            "format": "int32",
            "description": "The HTTP status code ([RFC7231], Section 6) generated by the origin server for this occurrence of the problem.",
            "nullable": true
          },
          "detail": {
            "type": "string",
            "description": "A human-readable explanation of what went wrong. It can include specifics about the issue, missing parameters, or invalid data.",
            "nullable": true
          },
          "instance": {
            "type": "string",
            "description": "A URL reference to a retrieve more information about the error, if available",
            "nullable": true
          },
          "errors": {
            "type": "object",
            "additionalProperties": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "nullable": true
          }
        },
        "additionalProperties": {}
      },
      "partyIdentification": {
        "type": "object",
        "description": "Description for Identification",
        "properties": {
          "identification": {
            "$ref": "#/components/schemas/Identification",
            "description": "Identification for party."
          }
        }
      },
      "Identification": {
        "type": "object",
        "description": "Identification for party.",
        "$ref": "#/components/schemas/OrganisationId",
        "additionalProperties": false
      },
      "OrganisationId": {
        "type": "object",
        "description": "Scheme identification details.",
        "properties": {
          "organisationId": {
            "$ref": "#/components/schemas/OrgIdOptions",
            "description": "Identification for the organisation."
          }
        }
      },
      "OrgIdOptions": {
        "oneOf": [
          {
            "$ref": "#/components/schemas/orgLei"
          },
          {
            "$ref": "#/components/schemas/orgAnyBIC"
          },
          {
            "$ref": "#/components/schemas/orgOthers"
          }
        ]
      },
      "orgLei": {
        "type": "object",
        "description": "Description for LEI",
        "properties": {
          "lei": {
            "$ref": "#/components/schemas/lei",
            "description": "Legal Entity Identifier (LEI) - Unique alphanumeric code that has 20 characters and is based on the ISO 17442 standard."
          }
        }
      },
      "lei": {
        "pattern": "[0-9]{4}[0]{2}[A-Z0-9]{12}[0-9]{2}",
        "type": "string",
        "description": "Legal Entity Identifier (LEI) - Unique alphanumeric code that has 20 characters and is based on the ISO 17442 standard.",
        "example": "646700J3LMYRBDP9MA86",
        "nullable": true
      },
      "orgAnyBIC": {
        "type": "object",
        "description": "Description for Identification",
        "properties": {
          "anyBIC": {
            "$ref": "#/components/schemas/anyBIC",
            "description": "Business identifier code (BIC) - Code allocated to a financial institution by the ISO 9362 Registration Authority. BIC8 and BIC11 accepted."
          }
        }
      },
      "anyBIC": {
        "pattern": "[A-Z0-9]{4,4}[A-Z]{2,2}[A-Z0-9]{2,2}([A-Z0-9]{3,3}){0,1}",
        "type": "string",
        "description": "Business identifier code (BIC) - Code allocated to a financial institution by the ISO 9362 Registration Authority. BIC8 and BIC11 accepted.",
        "example": "ABNANL2AXXX",
        "nullable": true
      },
      "orgOthers": {
        "type": "object",
        "description": "Description for Identification",
        "properties": {
          "others": {
            "$ref": "#/components/schemas/others",
            "description": "Other identification method."
          }
        }
      },
      
      "others": {
        "type": "object",
        "required":["identificationNumber"],
        "properties": {
          "identificationNumber": {
            "maxLength": 256,
            "type": "string",
            "description": "Identification code of the the reference party, as defined by scheme in the SEPA Implementation Guide and the RT1 Interface Spec.",
            "example": "DE89ZZZ44862148843541",
            "nullable": true
          },
          "schemeNameCode": {
            "maxLength": 4,
            "type": "string",
            "description": "Values allowed are as per ExternalOrganisationIdentification1Code in ISO 20022. Either SchemeNameCode or SchemeNameProprietary should be used, but not both.",
            "example": "CUST",
            "nullable": true
          },
          "schemeNameProprietary": {
            "maxLength": 35,
            "type": "string",
            "description": "Name of the identification scheme in a free text form. Either SchemeNameCode or SchemeNameProprietary should be used, but not both.",
            "example": "Prtry",
            "nullable": true
          },
          "issuer": {
            "maxLength": 35,
            "type": "string",
            "description": "The name of the entity that assigns the identification.",
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "Party": {
        "type": "object",
        "description": "The details of the intended payee to be checked against the account at the receiving PSP.",
        "oneOf": [
          {
            "$ref": "#/components/schemas/partyName"
          },
          {
            "$ref": "#/components/schemas/partyIdentification"
          }
        ]
      },
      "partyName": {
        "type": "object",
        "description": "Description for Name",
        "properties": {
          "name": {
            "$ref": "#/components/schemas/name",
            "description": "The name used to identify the legal owner of the account from which to debit/credit funds."
          }
        }
      },
      "name": {
        "maxLength": 140,
        "type": "string",
        "description": "The name used to identify the legal owner of the account from which to debit/credit funds. Populate either name or identification, but not both.",
        "example": "Mrs Mary L Green",
        "nullable": true
      },
      "PartyAccount": {
        "description": "The account details of the intended payee to be checked against the account at the receiving PSP.",
        "required": [
          "iban"
        ],
        "type": "object",
        "properties": {
          "iban": {
            "minLength": 1,
            "pattern": "[A-Z]{2,2}[0-9]{2,2}[a-zA-Z0-9]{1,30}",
            "type": "string",
            "description": "International Bank Account Number (IBAN) - identifier used internationally by financial institutions to uniquely identify the account of a customer.",
            "example": "NL59ABNA8424598490"
          }
        },
        "additionalProperties": false
      },
      "PartyAgent": {
        "type": "object",
        "required": ["financialInstitutionId"],
        "description": "The details of the receiving PSP who holds the account of the payee.",
        "properties": {
          "financialInstitutionId": {
            "$ref": "#/components/schemas/FinancialInstitutionId"
          }
        },
        "additionalProperties": false
      },
      "PayeeVerificationRequest": {
        "type": "object",
        "required":[
          "party",
          "partyAccount",
          "partyAgent"
        ],
        "properties": {
          "party": {
            "$ref": "#/components/schemas/Party"
          },
          "partyAccount": {
            "$ref": "#/components/schemas/PartyAccount"
          },
          "partyAgent": {
            "$ref": "#/components/schemas/PartyAgent"
          },
          "unstructuredRemittanceInformation": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Additional information related to the payment to include unstructured details for the beneficiary, such as invoice numbers, references, or other contextual information. Only one entry will be used. Limited to 140 characters per entry.",
            "example": "Transfer Ref 1886495537461152",
            "maxLength": 140,
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "PayeeVerificationResponse": {
        "type": "object",
        "properties": {
          "partyNameMatch": {
            "type": "string",
            "description": "Result of the Name Match. Supported codes are MTCH, NMTC, CMTC, NOAP.",
            "example": "MTCH",
            "nullable": true
          },
          "partyIdMatch": {
            "type": "string",
            "description": "Result of the Party Match. Supported codes are MTCH, NMTC, CMTC, NOAP.",
            "example": "null",
            "nullable": true
          },
          "matchedName": {
            "type": "string",
            "description": "Name of the account holder, may only be provided when the VoP check result is Close Match to allow the customer to decide whether to proceed with the payment.",
            "example": "null",
            "nullable": true
          }
        },
        "additionalProperties": false
      }
    }
  }
}